<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Optimizaci√≥n de Rutas - Guayaquil a UNEMI</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      background: #f5f8fa;
      font-family: 'Segoe UI', Arial, sans-serif;
      color: #23283a;
    }
    .dashboard-main {
      max-width: 1250px;
      margin: 35px auto;
      display: flex;
      flex-wrap: wrap;
      gap: 32px;
    }
    .col-left, .col-right {
      flex: 1 1 330px;
      min-width: 295px;
      max-width: 420px;
      display: flex;
      flex-direction: column;
      gap: 22px;
    }
    .col-right {
      flex: 2 1 570px;
      min-width: 360px;
      max-width: 780px;
      gap: 23px;
    }
    .card {
      background: #fff;
      border-radius: 17px;
      box-shadow: 0 2px 16px #bfd2f62a;
      padding: 20px 22px 16px 22px;
      margin-bottom: 0;
    }
    .card-mapa {
      padding: 10px;
      min-height: 320px;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    #map {
      width: 100%;
      height: 290px;
      min-height: 200px;
      border-radius: 13px;
      box-shadow: 0 2px 14px #b5d6ef33;
    }
    .card-inputs {
      display: flex;
      flex-direction: column;
      gap: 14px;
      padding-bottom: 10px;
    }
    .inputs-row {
      display: flex;
      gap: 15px;
      flex-wrap: wrap;
    }
    .inputs-row label {
      font-weight: 500;
      font-size: 1em;
      color: #3448b4;
      display: flex;
      align-items: center;
    }
    .inputs-row input[type=number] {
      padding: 6px 10px;
      border-radius: 8px;
      border: 1px solid #b0b8e6;
      width: 90px;
      font-size: 1em;
      margin-left: 4px;
    }
    #calcBtn {
      padding: 9px 36px;
      background: linear-gradient(90deg, #3267c2 60%, #53b9d8 100%);
      color: #fff;
      font-weight: bold;
      border: none;
      border-radius: 11px;
      font-size: 1.08em;
      cursor: pointer;
      margin-left: 16px;
      box-shadow: 0 2px 10px #b5d6ef30;
      transition: background 0.19s;
    }
    #calcBtn:hover {
      background: linear-gradient(90deg, #53b9d8 20%, #3267c2 90%);
    }
    .summary-optima {
      background: #e6faee;
      border-radius: 14px;
      padding: 16px 19px 9px 20px;
      box-shadow: 0 1px 7px #a4e9b9aa;
      font-size: 1.09em;
      display: flex;
      align-items: center;
      gap: 15px;
      margin-bottom: 5px;
    }
    .summary-optima .badge-optima {
      background: #2ab57b;
      color: #fff;
      padding: 6px 16px;
      font-size: 1.10em;
      border-radius: 17px;
      font-weight: bold;
      display: inline-flex;
      align-items: center;
      margin-right: 8px;
    }
    .summary-optima .badge-optima span {
      font-size: 1.32em;
      margin-right: 7px;
    }
    .summary-optima-details {
      margin-left: 6px;
    }
    .panel-tramos-box {
      display: flex;
      flex-direction: column;
      gap: 16px;
    }
    .panel-tramo {
      background: #f9fbff;
      border-radius: 12px;
      padding: 13px 15px 8px 15px;
      box-shadow: 0 1px 7px #bfd2f61c;
      margin-bottom: 0;
    }
    .panel-tramo h4 {
      color: #4253a2;
      margin-bottom: 9px;
      font-size: 1.09em;
      letter-spacing: 0.2px;
    }
    .tabla-comp {
      width: 100%;
      border-collapse: collapse;
      font-size: 1.06em;
      border-radius: 8px;
      overflow: hidden;
    }
    .tabla-comp th, .tabla-comp td {
      padding: 8px 6px;
      text-align: center;
      border-bottom: 1px solid #e8eaf2;
    }
    .tabla-comp th {
      background: #397cfb;
      color: #fff;
      font-weight: 700;
      font-size: 1em;
      letter-spacing: 0.1px;
    }
    .tabla-comp tr.optima {
      background: #e6faee !important;
    }
    .tabla-comp tr {
      background: #fff;
      transition: background 0.14s;
    }
    .tabla-comp tr:nth-child(even):not(.optima) {
      background: #f3f6fc;
    }
    .badge-estado {
      border-radius: 12px;
      padding: 3px 10px;
      font-size: 0.97em;
      font-weight: 600;
      display: inline-block;
    }
    .badge-optima2 {
      background: #30c78633;
      color: #30c786;
      border: 1px solid #30c78633;
    }
    .badge-alt {
      background: #e5e8f1;
      color: #375ac7;
      border: 1px solid #5cb3ff33;
    }
    .badge-score {
      background: #f1faf4;
      color: #20b57c;
      border-radius: 7px;
      padding: 2px 7px;
      font-size: 1.01em;
      font-weight: 500;
    }
    .tipo-bus {
      background: #e6eaff;
      color: #4253a2;
      border-radius: 7px;
      padding: 2px 8px;
      font-size: 0.97em;
    }
    .tiempo-celda {
      color: #ffa942;
      font-weight: bold;
    }
    .espera-celda {
      color: #7e48e3;
    }
    .leyenda-cong {
      font-size: 0.98em;
      color: #7187ac;
      margin: 4px 0 6px 0;
    }
    .chart-cont {
      margin-top: 2px;
      background: #f8fbfe;
      border-radius: 13px;
      box-shadow: 0 2px 13px #b5d6ef18;
      padding: 15px 14px 13px 14px;
    }
    .chart-cont h5 {
      margin-bottom: 4px;
      color: #2d4ca7;
      font-size: 1.06em;
      text-align: left;
      font-weight: 600;
    }
    @media (max-width:1100px) {
      .dashboard-main { flex-direction:column; gap:11px;}
      .col-left, .col-right { min-width:99vw; max-width:99vw; }
    }
    @media (max-width:600px) {
      #map {height:140px;}
      .card {padding: 8px 6px 6px 8px;}
    }
  </style>
</head>
<body>
  <div class="dashboard-main">
    <div class="col-left">
      <div class="card card-mapa">
        <div id="map"></div>
      </div>
      <div class="card card-inputs">
        <form id="inputsForm" onsubmit="return false;">
          <div class="inputs-row">
            <label>Capacidad Bus
              <input type="number" id="capBus" value="25" min="1">
            </label>
            <label>Guasmo Sur ‚Üí Terminal Gye
              <input type="number" id="dem1" value="180" min="0">
            </label>
          </div>
          <div class="inputs-row">
            <label>Terminal Gye ‚Üí Terminal Milagro
              <input type="number" id="dem2" value="300" min="0">
            </label>
            <label>Terminal Milagro ‚Üí UNEMI
              <input type="number" id="dem3" value="220" min="0">
            </label>
            <button id="calcBtn" type="button">Calcular</button>
          </div>
        </form>
      </div>
    </div>
    <div class="col-right">
      <div id="resumenOptima"></div>
      <div class="panel-tramos-box">
        <div class="panel-tramo" id="panelTramo1"></div>
        <div class="panel-tramo" id="panelTramo2"></div>
        <div class="panel-tramo" id="panelTramo3"></div>
      </div>
      <div class="chart-cont">
        <h5>Comparativa de Frecuencias (Interprovinciales)</h5>
        <canvas id="chartInter"></canvas>
      </div>
    </div>
  </div>
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <script>
    // --- Mapa ---
    const coordGuasmo = [-2.235118, -79.879482];
    const coordTerminalGye = [-2.148214, -79.883579];
    const coordTerminalMilagro = [-2.134802, -79.590637];
    const coordUNEMI = [-2.147908, -79.602188];
    const ruta = [coordGuasmo, coordTerminalGye, coordTerminalMilagro, coordUNEMI];
    const paradas = [
      {coord: coordGuasmo, name: "Guasmo Sur<br><span class='tipo-bus'>Metrov√≠a</span>"},
      {coord: coordTerminalGye, name: "Terminal Gye<br><span class='tipo-bus'>Interprovincial</span>"},
      {coord: coordTerminalMilagro, name: "Terminal Milagro<br><span class='tipo-bus'>Interprovincial / Urbano</span>"},
      {coord: coordUNEMI, name: "UNEMI<br><span class='tipo-bus'>Bus Urbano</span>"}
    ];
    let map = L.map('map').setView([-2.18, -79.8], 11);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {maxZoom: 18}).addTo(map);
    let markers = [];
    paradas.forEach(p => {
      let m = L.marker(p.coord).addTo(map);
      m.bindPopup(p.name);
      markers.push(m);
    });
    let tramoLines = [];
    function drawRuta(tramoOpt){
      if(tramoLines.length) tramoLines.forEach(l=>map.removeLayer(l));
      tramoLines = [];
      for(let i=0;i<ruta.length-1;i++){
        let color = "#30c786";
        if(i===tramoOpt) color = "#ffa942";
        if(i===0) color = "#2d8bef";
        if(i===2) color = "#44be8a";
        let line = L.polyline([ruta[i],ruta[i+1]], {
          color: color, weight: 7, opacity: 0.93
        }).addTo(map);
        tramoLines.push(line);
      }
      map.fitBounds(L.polyline(ruta).getBounds(),{padding:[12,12]});
    }

    // --- Datos buses por tramo ---
    const empresasInter = [
      {nombre:"Citim", frecuencia:6, espera:5, tiempo:90, score:46.5},
      {nombre:"Ruta Milagra√±a", frecuencia:6, espera:6, tiempo:85, score:44.7},
      {nombre:"Expreso Milagro", frecuencia:4, espera:8, tiempo:80, score:42.3},
      {nombre:"Ejecutivo Express", frecuencia:3, espera:10, tiempo:75, score:41.1}
    ];
    const datosMetrov√≠a = {empresa:"Metrov√≠a", frecuencia:12, espera:3, tiempo:35};
    const datosUrbano = {empresa:"Bus Urbano Milagro", frecuencia:10, espera:3, tiempo:15};

    // --- Render UI ---
    function renderTodo(){
      let capacidad = parseInt(document.getElementById('capBus').value)||1;
      let dem1 = parseInt(document.getElementById('dem1').value)||0;
      let dem2 = parseInt(document.getElementById('dem2').value)||0;
      let dem3 = parseInt(document.getElementById('dem3').value)||0;

      // Panel 1
      let panel1 = `<h4>Guasmo Sur ‚Üí Terminal Terrestre Guayaquil</h4>
        <table class="tabla-comp">
          <tr>
            <th>Empresa</th>
            <th>Frecuencia</th>
            <th>Espera</th>
            <th>Tiempo viaje</th>
            <th>Demanda</th>
            <th>Ocupaci√≥n</th>
          </tr>
          <tr class="optima">
            <td><span class="tipo-bus">Metrov√≠a</span></td>
            <td>${datosMetrov√≠a.frecuencia} buses/h</td>
            <td class="espera-celda">${datosMetrov√≠a.espera} min</td>
            <td class="tiempo-celda">${datosMetrov√≠a.tiempo} min</td>
            <td>${dem1}</td>
            <td>${Math.round((dem1/(capacidad*datosMetrov√≠a.frecuencia))*1000)/10 || 0}%</td>
          </tr>
        </table>
        <div class="leyenda-cong">Frecuencia y espera fija del sistema Metrov√≠a.</div>`;

      // Panel 2: interprovinciales (tablas y √≥ptima)
      let optIx = 0, maxScore = empresasInter[0].score;
      for(let i=1;i<empresasInter.length;i++){
        if(empresasInter[i].score > maxScore) { optIx = i; maxScore = empresasInter[i].score; }
      }
      let panel2 = `<h4>Terminal Terrestre Guayaquil ‚Üí Terminal Milagro</h4>
        <table class="tabla-comp">
          <tr>
            <th>Empresa</th>
            <th>Frecuencia</th>
            <th>Espera</th>
            <th>Tiempo viaje</th>
            <th>Demanda</th>
            <th>Ocupaci√≥n</th>
            <th>Score</th>
            <th>Estado</th>
          </tr>`;
      for(let i=0;i<empresasInter.length;i++){
        let e = empresasInter[i];
        let ocup = Math.round((dem2/(capacidad*e.frecuencia))*1000)/10 || 0;
        panel2 += `<tr class="${i===optIx?'optima':''}">
          <td><span class="tipo-bus">üöç ${e.nombre}</span></td>
          <td>${e.frecuencia} buses/h</td>
          <td class="espera-celda">${e.espera} min</td>
          <td class="tiempo-celda">${e.tiempo} min</td>
          <td>${dem2}</td>
          <td>${ocup}%</td>
          <td><span class="badge-score">${e.score}%</span></td>
          <td>
            ${i===optIx
              ?'<span class="badge-estado badge-optima2">üèÜ √ìptima</span>'
              :'<span class="badge-estado badge-alt">Alternativa</span>'
            }
          </td>
        </tr>`;
      }
      panel2 += `</table>
        <div class="leyenda-cong">Se recomienda la empresa con mejor score (menor tiempo, mayor frecuencia y menor ocupaci√≥n).</div>`;

      // Panel 3
      let panel3 = `<h4>Terminal Milagro ‚Üí UNEMI</h4>
        <table class="tabla-comp">
          <tr>
            <th>Empresa</th>
            <th>Frecuencia</th>
            <th>Espera</th>
            <th>Tiempo viaje</th>
            <th>Demanda</th>
            <th>Ocupaci√≥n</th>
          </tr>
          <tr class="optima">
            <td><span class="tipo-bus">Bus Urbano</span></td>
            <td>${datosUrbano.frecuencia} buses/h</td>
            <td class="espera-celda">${datosUrbano.espera} min</td>
            <td class="tiempo-celda">${datosUrbano.tiempo} min</td>
            <td>${dem3}</td>
            <td>${Math.round((dem3/(capacidad*datosUrbano.frecuencia))*1000)/10 || 0}%</td>
          </tr>
        </table>
        <div class="leyenda-cong">Transporte urbano local de Milagro, frecuencia promedio estimada.</div>`;

      // Tarjeta resumen global
      let tiempoTotal = datosMetrov√≠a.tiempo + empresasInter[optIx].tiempo + datosUrbano.tiempo;
      let costoTotal = 2.90 + (empresasInter[optIx].nombre=="Citim"?3.15:empresasInter[optIx].nombre=="Ruta Milagra√±a"?2.90:empresasInter[optIx].nombre=="Expreso Milagro"?3.65:4.15) + 0.40;
      let ocupacionGlobal = Math.round(((dem1/(capacidad*datosMetrov√≠a.frecuencia)) + (dem2/(capacidad*empresasInter[optIx].frecuencia)) + (dem3/(capacidad*datosUrbano.frecuencia))) / 3 * 1000)/10;
      let resumen = `<div class="summary-optima">
        <span class="badge-optima"><span>üèÜ</span> Ruta √ìptima</span>
        <div class="summary-optima-details">
          <b>Metrov√≠a ‚Üí ${empresasInter[optIx].nombre} ‚Üí Bus Urbano</b><br>
          <span style="color:#4253a2;">Tiempo total:</span> ${tiempoTotal} min &nbsp;|&nbsp;
          <span style="color:#a941d6;">Costo total:</span> $${costoTotal.toFixed(2)} &nbsp;|&nbsp;
          <span style="color:#26a856;">Ocupaci√≥n prom.:</span> ${ocupacionGlobal}% &nbsp;|&nbsp;
          <span style="color:#20b57c;">Score:</span> ${empresasInter[optIx].score}%
        </div>
      </div>`;

      // Render
      document.getElementById('panelTramo1').innerHTML = panel1;
      document.getElementById('panelTramo2').innerHTML = panel2;
      document.getElementById('panelTramo3').innerHTML = panel3;
      document.getElementById('resumenOptima').innerHTML = resumen;
      drawRuta(1);
      renderGraficoInter();
    }

    // --- Gr√°fica comparativa ---
    let chartInter;
    function renderGraficoInter(){
      let ctx = document.getElementById('chartInter').getContext('2d');
      let datos = empresasInter.map(e=>e.frecuencia);
      let labels = empresasInter.map(e=>e.nombre);
      if(chartInter) chartInter.destroy();
      chartInter = new Chart(ctx, {
        type: 'bar',
        data: {
          labels: labels,
          datasets: [{
            label: 'Frecuencia (buses/h)',
            data: datos,
            backgroundColor: ['#379eff','#6736b7','#e7bb45','#44be8a']
          }]
        },
        options: {
          responsive: true,
          plugins: { legend: { display:false }},
          animation: { duration: 800, easing: 'easeInOutQuart' },
          scales: { y: { beginAtZero: true, ticks: { precision:0 } } }
        }
      });
    }

    document.getElementById('calcBtn').onclick = renderTodo;
    window.onload = renderTodo;
  </script>
</body>
</html>
